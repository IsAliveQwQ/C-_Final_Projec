# 漫畫租書系統 WinFormsApp

## 專案簡介
本專案為 C# WinForms 桌面應用程式，結合 MySQL 資料庫，提供漫畫租借、預約、管理員後台等完整功能。
支援用戶與管理員分權、完整歷史紀錄查詢、UI 友善、資料一致性高。

---


## 安裝與執行

### 1. 環境需求
- Windows 10/11
- .NET 7.0 (或以上)
- MySQL 8.0 (或相容版本)

### 2. 套件安裝
- NuGet：`MySql.Data`,`MinIO`
          
### 3. 執行專案
- 以 Visual Studio 開啟 `WinFormsApp1.sln`，建置並執行。
---

## 功能說明

### 使用者端
- 查詢漫畫（多欄位模糊查詢）
- 借書、還書（含冷卻期、預約優先權）
- 預約、取消預約（24 小時內有效，取消僅更新狀態不刪除紀錄）
- - 使用者預約後24小時內，可隨時在預約紀錄操作欄點擊「取消預約」按鈕，取消自己的預約。
- - 取消預約後，該預約紀錄狀態會標記為「已取消」，但不會從資料庫刪除，完整保留歷史。
- - 只有「預約成功」狀態的預約才會顯示「取消預約」按鈕。
- 查詢完整借閱/預約歷史紀錄（含已還、已取消、已到期），並可對借閱中的紀錄進行還書操作，對預約中的紀錄進行取消預約操作。

#### 資料一致性與UI同步保證
- 所有借書、還書、預約、取消預約等操作，皆會直接更新資料庫。
- UI 顯示內容（主表、右側詳細資訊、按鈕狀態）每次都根據資料庫最新內容即時刷新，不依賴快取或DataGridView行資料。
- 每次操作後自動查詢資料庫最新狀態並刷新UI，確保資料一致且無快取問題。
- 所有狀態、按鈕啟用/禁用、顯示內容都只根據資料庫查詢結果，完全符合規範。

### 管理員端
- 用戶管理（新增、刪除、重設密碼）
- 漫畫管理（新增、刪除、查詢）
- 借閱/預約紀錄查詢
- 權限分離：管理員登入時無法於使用者介面進行借書/預約等操作

1. 書未被借出、無人預約
任何人可借、可預約。
2. 書未被借出，有人預約
只有預約者可借，其他人不可借、不可預約。
3. 書被借出
任何人都不可預約、不可借（除了還書操作）。
借書者還書後，才重新開放預約/借閱。
4. 冷卻期
借書者還書後24小時內，該用戶不可再借、不可預約同一本書。
預約者預約後24小時內，不可再預約同一本書。
5. 借書時自動取消自己預約
如果自己有預約，借書時自動取消該預約紀錄。
【狀態表】
| 狀態 | 借閱按鈕 | 預約按鈕 | 備註 |
|--------------|------------------|------------------|------------------------------|
| 無人預約未借 | 可借 | 可預約 | |
| 有人預約 | 只有預約者可借 | 其他人不可預約 | |
| 已借出 | 不可借 | 不可預約 | 任何人都不能預約 |
| 還書 | 可借/可預約 | | 冷卻期內的用戶不可借/預約 |
| 冷卻期 | 不可借 | 不可預約 | |
【UI/資料同步】
書被借出時，預約按鈕必須禁用，狀態顯示「不可預約」。
還書後，預約按鈕才啟用，狀態顯示「可預約」。
所有操作後，所有表格與詳細資訊都要刷新。

---

## 資料庫連線

- 連線字串設定於 `DBHelper.cs`，如需更改請依實際環境調整。

---
